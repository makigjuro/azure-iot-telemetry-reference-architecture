@startuml
!include https://raw.githubusercontent.com/plantuml-stdlib/C4-PlantUML/master/C4_Context.puml

LAYOUT_WITH_LEGEND()

System_Boundary(aca, "Azure Container Apps Env") {
    Container(api, "IoT Gateway/API", ".NET 9", "Receives telemetry via HTTP/MQTT, JWT auth")
    Container(svc_ingest, "Telemetry Ingestor", ".NET 9 worker", "Validates telemetry, emits CloudEvents")
    Container(svc_proc, "Telemetry Processor", ".NET 9 worker", "Consumes telemetry, writes to ADLS")
    Container(svc_alert, "Alert Service", ".NET 9 worker", "Subscribes to Event Grid; triggers alerts")
}

ContainerDb(storage, "ADLS Gen2", "Azure Storage", "Telemetry data: Raw/Bronze/Silver/Gold")
Container(eventgrid, "Event Grid", "Topic/Subscriptions", "CloudEvents 1.0")
Container(kv, "Key Vault", "Secrets/Keys")
Container(syn, "Synapse", "Pipelines/SQL")
Container(fabric, "Fabric", "Lakehouse/Reports (optional)")
Container(log, "Log Analytics + App Insights", "Observability")

Rel(api, svc_ingest, "Telemetry HTTP/MQTT â†’ Worker")
Rel(svc_ingest, eventgrid, "Publish telemetry events")
Rel(eventgrid, svc_proc, "Push telemetry events")
Rel(svc_proc, storage, "ADLS writes via MSI")
Rel(storage, syn, "ETL")
Rel(syn, fabric, "Datasets")
Rel(api, kv, "MSI -> Secrets")
Rel(svc_ingest, log, "Logs/Traces")
Rel(svc_proc, log, "Logs/Traces")
Rel(svc_alert, log, "Logs/Traces")
@enduml